\documentclass{beamer}
% Choose your desired theme
% \usetheme{Boadilla}
\usepackage[style=numeric]{biblatex}
\usepackage{listings}

\addbibresource{./cabi.bib}
\title{Pedaling Towards Progress}
\subtitle{Analyzing Washington, DC's Bikesharing system using Open-source tools}
\author{Maxwell Lindsay}
\institute{Van Oord}
\date{\today}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}
\section{Introduction}
\begin{frame}
    % consider splitting into a few slides with more pictures
    \frametitle{Introduction to Capital Bikeshare (Aka CaBi)}
    \begin{columns}
        \column{0.5\textwidth}
        \begin{figure}
            \includegraphics[]{800px-VA_07_2012_Capital_Bikeshare_4152.JPG}
            % \caption{By Mariordo (Mario Roberto DurÃ¡n Ortiz) - Own work, CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=20462784}
        \end{figure}
        \column{0.5\textwidth}
        \begin{itemize}
            \item Memberships are available for \$95 a year for unlimited trips under 45 minutes \cite{cabisite}. Casual users can pay \$1 to unlock the bike, then \$0.05 per minute.
            \item Primarily intended for short trips
            \item Docked bikeshare
            \item 700+ docks, ~35 million trips (so far)
        \end{itemize}

    \end{columns}
    \small{* recently, non-docked E-bikes that have been introduced}
\end{frame}

\begin{frame}
    \frametitle{The data}

    Capital Bikeshare publishes the following data about each trip on a monthly basis:

    \begin{itemize}
        \item start time
        \item end time
        \item start station index
        \item end station index
        \item Membership status of the rider (Member or Non-member?)
    \end{itemize}

    These data are available as csv files per month or year from Capital Bikeshare at https://ride.capitalbikeshare.com/system-data
\end{frame}

\begin{frame}
    \frametitle{My goal}

    \begin{itemize}
        \item Analyze all trips up to the present day
        \item Street-level estimates of bikeshare use
        \item Inspired by A blog post from Daniel J patterson from 2020
    \end{itemize}

\end{frame}

\section{Methodology}
\begin{frame}
    \frametitle{Overview of my approach}
    \begin{enumerate}
        \item Download CSVs of every trip
        \item Parse and normalize the CSVs using Pandas
        \item Find The number of trips between unique pairs of stations
        \item Build Valhalla routing tiles
        \item Find a route between each station pair using Valhalla
        \item Aggregate the trip statistics across every single route
    \end{enumerate}
\end{frame}

\begin{frame}
    \frametitle{1. Download CSVs of every trip}
    The raw CSV files are available from the Capital Bikeshare Data portal. This is a small example what the data looks like
    \begin{table}[]
        \begin{tabular}{lllllllllllll}
            \hline
            \multicolumn{1}{|l|}{ride\_id} & \multicolumn{1}{l|}{rideable\_type} & \multicolumn{1}{l|}{started\_at} & \multicolumn{1}{l|}{ended\_at} & \multicolumn{1}{l|}{start\_station\_name} & \multicolumn{1}{l|}{start\_station\_id} & \multicolumn{1}{l|}{end\_station\_name} & \multicolumn{1}{l|}{end\_station\_id} & \multicolumn{1}{l|}{start\_lat} & \multicolumn{1}{l|}{start\_lng} & \multicolumn{1}{l|}{end\_lat} & \multicolumn{1}{l|}{end\_lng} & \multicolumn{1}{l|}{member\_casual} \\ \hline
            5F3D280238A782FE               & docked\_bike                        & 2023-05-12 18:57:59              & 2023-05-12 19:17:50            & 3rd \& Tingey St SE                       & 31634                                   & 8th \& F St NE                          & 31631                                 & 38.87501                        & -77.0024                        & 38.897274                     & -76.994749                    & casual                              \\
            97EC218DACB24849               & classic\_bike                       & 2023-05-23 07:55:29              & 2023-05-23 08:11:12            & Clarendon Blvd \& Pierce St               & 31016                                   & 15th \& L St NW                         & 31276                                 & 38.893438                       & -77.076389                      & 38.903649                     & -77.034918                    & member                              \\
            31D19AC7BA317018               & electric\_bike                      & 2023-05-05 17:27:10              & 2023-05-05 17:40:17            & South Capitol St and Southern Ave SE      & 31830                                   & Tanger Outlets                          & 32415                                 & 38.821667433                    & -77.001627445                   & 38.7968                       & -77.0026                      & member
        \end{tabular}
    \end{table}
\end{frame}

\begin{frame}
    \frametitle{2. Parse and normalize the CSVs using Pandas}
    
    For each trip, the trip time is calculated. 
    
    Then invalid trips are removed based on the following criteria: 
    \begin{itemize}
        \item Longer than a 4 hours

        % This is an arbitrary threshold. However, the CaBi system is primarily intended for short trips, and the pricing reflects this. The bikes can be used for leisure and tourism, but they are priced to encourage users to change bikes regularly. Also, for the purposes of this project, long trips are less likely to have

        \item Starting and ending at the same station

        % For obvious reasons, cannot easily be routed

        \item Stations with an invalid start or end station

        % A number of trips in the dataset are missing a value for the start or ending point
    \end{itemize}

    As of May 2023 there are 35,231,413 trips. 175,603 are removed due to being too long
\end{frame}

\begin{frame}
    \frametitle{Find unique trips between two stations}
    These 35,136,810 trips reduce to 183,959 unique trips if we consider A>B and B>A different trips.

    

    If we drop trips that start and end at the same dock, there are 183,214 unique trips. If we consider only the start and end stations, this further reduces to 105,636.

    \emph{These trips are the final ones to route}
\end{frame}

\begin{frame}
    \frametitle{Building a Valhalla Routing network}

    \begin{itemize}
        \item Download OSM tiles
        \item Build Valhalla routing network
        \item Use Pandas the start and end point of every unique trip
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Build PostGIS topology at the same time}
    \begin{itemize}
        \item Using PLpgSQL triggers, add a corresponding entry to the topogeometry table for every new entry to the routes tables
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Sum up the trips on every topological element}

    \begin{itemize}
        \item Using an SQL query, we can sum the trips on every unique street
    \end{itemize}

\end{frame}

\begin{frame}
    \frametitle{Results}

    

    

\end{frame}
\section{Conclusions}
\begin{frame}
    \frametitle{Lessons learned}

    \begin{itemize}
        \item Routing is *much* faster if you run it locally as binaries rather than a web api from a container
        \item Valhalla allows a like of parameters for bike routing and is lightning fast
    \end{itemize}



\end{frame}
\section{notes and thanks}
\begin{frame}
    \frametitle{Shoutouts}

    \begin{itemize}
        \item GIS-OPS for their thoughtful and intuitive Valhalla Docker containers
        \item
    \end{itemize}



\end{frame}
\end{document}
